{% extends 'core/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
{% endblock %}

{% block content %}
<!-- Preload LCP image -->
<link rel="preload"
  href="https://res.cloudinary.com/dqm1exvp6/image/upload/v1758025132/photo-1585896202909-fbde6c17fc15_uz8cor.avif"
  as="image" fetchpriority="high">
<!-- Preconnect to critical third-party origins -->
<link rel="preconnect" href="https://res.cloudinary.com">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- Magic Particles -->
<div class="magic-particles" id="particles"></div>

<!-- Hero Section -->
<section class="hero-section">
  <div class="hero-bg">
    <img src="https://res.cloudinary.com/dqm1exvp6/image/upload/v1758025132/photo-1585896202909-fbde6c17fc15_uz8cor.avif"
      srcset="
            https://res.cloudinary.com/dqm1exvp6/image/upload/v1758025132/photo-1585896202909-fbde6c17fc15_uz8cor.avif 400w,
            https://res.cloudinary.com/dqm1exvp6/image/upload/v1758025132/photo-1585896202909-fbde6c17fc15_uz8cor.avif 800w,
            https://res.cloudinary.com/dqm1exvp6/image/upload/v1758025132/photo-1585896202909-fbde6c17fc15_uz8cor.avif 1200w,x
            https://res.cloudinary.com/dqm1exvp6/image/upload/v1758025132/photo-1585896202909-fbde6c17fc15_uz8cor.avif 1920w
          " sizes="(max-width: 768px) 100vw, (max-width: 1200px) 100vw, 1920px" alt="Doğa Arka Plan" width="1920"
      height="1080" fetchpriority="high" decoding="async">
    <div class="overlay"></div>
  </div>
  <div class="container">
    <div class="row align-items-center">
      <div class="text-center">
        <h1 class="display-3 mb-4">Merhaba Ben
          <br>
          <span class="text-gradient">Melih</span>
        </h1>
        <p class="profile-role" style="color: aliceblue;">Kelimeler, düşüncelerin özgürlüğe açılan kapısıdır.</p>
        <div class="text-center">
          <a href="{% url 'core:blog_posts' %}" class="btn btn-primary"
            aria-label="Blog sayfasına git">Blog'umu Keşfet</a>
        </div>
      </div>
    </div>
  </div>
  <!-- Scroll Down Icon -->
  <div class="scroll-down">
    <a href="#blog" class="text-white" aria-label="Aşağı kaydır">
      <i class="fas fa-chevron-down"></i>
    </a>
  </div>
</section>

<!-- Blog Posts Section -->
<section id="blog" class="py-5 bg-white">
  <div class="container">
    <div class="text-center mb-5">
      <h2 class="section-title">Son Yazılarım</h2>
      <p class="section-subtitle">Güncel düşüncelerim ve keşiflerim</p>
    </div>
    <div class="blog-grid">
      {% for post in posts|slice:":6" %}
      <div class="blog-card">
        <a href="{% url 'core:post_detail' post.slug %}" class="text-decoration-none text-dark"
          aria-label="{{ post.title }}">
          {% if post.image %}
          <div class="blog-image-wrapper">
            <img src="{{ post.image.url }}" alt="{{ post.title }}" loading="lazy"
              decoding="async" width="400" height="200">
            <div class="blog-overlay">
              <span>Devamını Oku</span>
            </div>
          </div>
          {% else %}
          <div class="blog-image-placeholder bg-light d-flex align-items-center justify-content-center"
            style="height: 200px;">
            <i class="fas fa-book-open fa-3x text-muted" aria-hidden="true"></i>
          </div>
          {% endif %}
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              {% if post.categories.exists %}
              {% for category in post.categories.all %}
              <span class="badge bg-primary me-1">
                {{ category.name }}
              </span>
              {% endfor %}
              {% else %}
              <span class="badge bg-secondary">Genel</span>
              {% endif %}
              <small class="text-muted">{{ post.date_posted|date:"d F Y" }}</small>
            </div>
            <h3 class="card-title">{{ post.title }}</h3>
            <p class="card-text">{{ post.content|striptags|truncatechars:120|safe }}</p>
          </div>
          <div class="card-footer bg-white border-0 d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
              <img src="{% static 'images/default-avatar.png' %}" class="rounded-circle me-2" width="30" height="30"
                alt="{{ post.author }}" loading="lazy" decoding="async">
              <small class="text-muted">{{ post.author }}</small>
            </div>
            <span class="badge bg-light text-dark">
              <i class="far fa-clock me-1" aria-hidden="true"></i>{{ post.reading_time }} dakika
            </span>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
    <div class="text-center mt-5">
      <a href="{% url 'core:blog_posts' %}" class="btn btn-primary"
        aria-label="Tüm blog yazılarını gör">
        Tüm Yazıları Gör <i class="fas fa-arrow-right ms-2" aria-hidden="true"></i>
      </a>
    </div>
  </div>
</section>

<!-- Newsletter Section - YENİ TASARIM -->
<section id="newsletter" class="py-5 bg-light">
  <div class="container">
    <!-- Messages Area -->
    {% if messages %}
    <div class="row justify-content-center mb-4">
      <div class="col-lg-8">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card border-0 shadow-sm">
          <div class="card-body p-5 text-center">
            <div class="mb-4">
              <i class="fas fa-envelope-open-text fa-3x text-primary mb-3"></i>
              <h2 class="h4 fw-bold">Yazılarımı Kaçırmayın</h2>
              <p class="text-muted mb-0">En yeni blog yazıları doğrudan e-posta adresinize gelsin.</p>
            </div>
            
            <!-- Error Message for Privacy Policy -->
            <div id="privacyError" class="alert alert-danger d-none mb-4" role="alert">
              <i class="fas fa-exclamation-circle me-2" aria-hidden="true"></i>
              Lütfen gizlilik politikasını kabul edin
            </div>
            
            <form id="newsletterForm" method="POST" action="{% url 'core:subscribe_newsletter' %}" novalidate class="mb-3">
              {% csrf_token %}
              <div class="row g-3">
                <div class="col-md-5">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="subscriberName" name="name" placeholder="Adınız" required
                      aria-label="Adınız">
                    <label for="subscriberName">Adınız</label>
                  </div>
                </div>
                <div class="col-md-5">
                  <div class="form-floating">
                    <input type="email" class="form-control" id="subscriberEmail" name="email" placeholder="E-posta"
                      required aria-label="E-posta adresiniz">
                    <label for="subscriberEmail">E-posta Adresiniz</label>
                  </div>
                </div>
                <div class="col-md-2">
                  <button type="submit" class="btn btn-primary h-100 w-100">
                    Abone Ol
                  </button>
                </div>
              </div>
              
              <!-- Honeypot field -->
              <div style="display:none;">
                <input type="text" name="website">
              </div>
              
              <!-- Privacy Policy Checkbox -->
              <div class="form-check mt-3 justify-content-center d-flex">
                <input class="form-check-input me-2" type="checkbox" id="privacyAgreement" name="privacy_check" required
                  aria-label="Gizlilik politikasını kabul ediyorum">
                <label class="form-check-label small text-muted" for="privacyAgreement">
                  <a href="{% url 'core:gizlilik' %}" class="text-decoration-underline" target="_blank"
                    rel="noopener noreferrer">Gizlilik Politikasını</a> kabul ediyorum
                </label>
              </div>
            </form>
            
            <p class="small text-muted mb-0">
              <i class="fas fa-lock me-1" aria-hidden="true"></i> Bilgileriniz güvende. İstediğiniz zaman abonelikten çıkabilirsiniz.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Load external resources -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<link rel="stylesheet" href="{% static 'css/sidebar.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/fontawesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/solid.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<script>
  // Create subtle floating particles
  function createMagicParticles() {
    const particlesContainer = document.getElementById('particles');
    
    for (let i = 0; i < 12; i++) {
      const particle = document.createElement('div');
      particle.classList.add('particle');
      particle.style.left = Math.random() * 100 + '%';
      particle.style.top = Math.random() * 100 + '%';
      particle.style.animationDelay = Math.random() * 8 + 's';
      particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
      particlesContainer.appendChild(particle);
    }
  }

  // Initialize particles on load
  window.addEventListener('load', createMagicParticles);

  // Newsletter form validation
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('newsletterForm');
    const privacyError = document.getElementById('privacyError');
    const privacyCheckbox = document.getElementById('privacyAgreement');
    
    if (form && privacyError && privacyCheckbox) {
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        privacyError.classList.add('d-none');
        
        if (!privacyCheckbox.checked) {
          privacyError.classList.remove('d-none');
          privacyCheckbox.focus();
          return;
        }
        
        if (form.checkValidity()) {
          form.submit();
        }
      });
      
      privacyCheckbox.addEventListener('change', function () {
        if (this.checked) {
          privacyError.classList.add('d-none');
        }
      });
    }

    // Auto-dismiss messages
    setTimeout(function () {
      var alerts = document.querySelectorAll('.alert');
      alerts.forEach(function (alert) {
        if (typeof bootstrap !== 'undefined') {
          var bsAlert = new bootstrap.Alert(alert);
          bsAlert.close();
        }
      });
    }, 5000);
  });
</script>
{% endblock %}